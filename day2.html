<!DOCTYPE html>
<html>
  <head>
    <title>handee's aoc25: day 2</title>
    <link rel="stylesheet" href = "aoc25.css" media="screen">
  </head>
</html>
<body>
  <input type="file" name="inputfile" id="inputfile">
  <br>
  <h1>Part One</h1>
  <h2>There are this many invalid IDs:</h2>
  <pre id="output"></pre>
  <h2>The invalid IDs add up to:</h2>
  <pre id="output2"></pre>
  <h1>Part Two</h1>
  <h2>There are this many invalid IDs:</h2>
  <pre id="outputp2"></pre>
  <h2>The invalid IDs add up to:</h2>
  <pre id="outputp22"></pre>

  <script type="text/javascript">
    function is_even(n) {
          return (n % 2 == 0);
        }

    function get_factors(n) {
          let factors=[1]; // one is always a factor
          // so is n but we don't need that so we'll leave it out
          for (i=2;i<=Math.floor(Math.sqrt(n)); i++) {
                // square root trick - factors come in pairs
                if (n % i === 0) {
                      factors.push(i);
                      if ((i*i) !== n) { // if n is not i squared
                            factors.push(n/i);
                          }
                    }
              }
          return(factors);

        }

    function are_the_same(a) {
          // takes an array a and returns true if all the elements are 
          // idential otherwise false.
          let i=0
          rv=true
          while (i<a.length-1) {
                if (a[i]!==a[i+1]) {
                  rv=false;
                  break;
               } else {
                  i+=1;
               }
         }
         if (a.length==1) {
               rv=false;
         }
         return(rv)

    }  


    document.getElementById('inputfile')
      .addEventListener('change', function () {
            let invalid_count=0;
            let invalid_count2=0;
            let total=0;
            let total2=0;
            let fr = new FileReader();
            let factor_array= [];
            //let us just cache the factors for numbers up to 12
            //don't think there are any ids longer than 12 digits
            for (let i=0;i<=12;i++) {
               factor_array[i]=get_factors(i);
            }

            fr.onload = function () {
              const lines = fr.result.split(',');
              for (let i=0;i<lines.length;i++) {
                    // for each group of input ids
                [start,end]=lines[i].split('-');
                for (let j=Number(start);j<=Number(end);j++) {
                      // for each id in range
                  let valid=1;
                  value=String(j);
                  //part one
                  if (is_even(value.length)) {  
                  // no point testing them if l is odd 
                    l=value.length /2;
                    back_part=value.slice(0,l);
                    front_part=value.slice(l);
                    if (back_part == front_part){ 
                      invalid_count++;
                      total+=Number(j);
                    }
                  } //end part one
                  // part two
                  for (let findex=0;findex<factor_array[value.length].length;findex++) {
                    if (valid===1) {
                      let current_factor=Number(factor_array[value.length][findex]);
                      //split value string into candidates
                      matchregex=new RegExp('.{'+current_factor+'}', 'g');
                      candidates=value.match(matchregex);
                      if (are_the_same(candidates)){
                        console.log(candidates)
                        console.log("INVALID:",value)
                        valid=0;
                        invalid_count2+=1
                        total2+=Number(j)
                      }
                    } // end 'if valid'
                  } // end part 2

                } // end for each number in the range
              } // end for each range

              document.getElementById('output').textContent = invalid_count;
              document.getElementById('output2').textContent = total;
              document.getElementById('outputp2').textContent = invalid_count2;
              document.getElementById('outputp22').textContent = total2;
            };
            fr.readAsText(this.files[0]);
          })
  </script>
              <!-- 30962646867 was too high -->
</body>
            </html>
